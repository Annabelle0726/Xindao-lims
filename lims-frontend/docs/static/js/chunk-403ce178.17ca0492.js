(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-403ce178"],{"0ccb":function(e,t,a){"use strict";var i=a("e330"),l=a("50c4"),n=a("577e"),o=a("1148"),r=a("1d80"),s=i(o),c=i("".slice),d=Math.ceil,u=function(e){return function(t,a,i){var o,u,p=n(r(t)),m=l(a),f=p.length,b=void 0===i?" ":n(i);return m<=f||""===b?p:(o=m-f,u=s(b,d(o/b.length)),u.length>o&&(u=c(u,0,o)),e?p+u:u+p)}};e.exports={start:u(!1),end:u(!0)}},"4d90":function(e,t,a){"use strict";var i=a("23e7"),l=a("0ccb").start,n=a("9a0c");i({target:"String",proto:!0,forced:n},{padStart:function(e){return l(this,e,arguments.length>1?arguments[1]:void 0)}})},"71ca":function(e,t,a){},"9a0c":function(e,t,a){"use strict";var i=a("342f");e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)},a5ea:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticStyle:{margin:"10px 0",display:"flex","align-items":"center","justify-content":"space-between"}},[e._m(0),a("div",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.getYearTableData}},[e._v("刷新")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.addYearPlan("add")}}},[e._v("新增")])],1)]),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.yearTableDataLoading,expression:"yearTableDataLoading"}],ref:"yearTable",attrs:{data:e.yearTableData,height:"calc(60vh - 16em)","header-cell-style":{background:"#f8f8f9",color:"#515a6e"},border:"","highlight-current-row":""},on:{"current-change":e.currentChange}},[a("el-table-column",{attrs:{align:"center","header-align":"center",label:"序号",prop:"prop",type:"index",width:"70"}}),a("el-table-column",{attrs:{label:"年份","min-width":"80",prop:"planYear"}}),a("el-table-column",{attrs:{label:"计划名称","min-width":"180",prop:"planName","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"编制人","min-width":"100",prop:"writeName"}}),a("el-table-column",{attrs:{label:"编制日期","min-width":"160",prop:"writeTime"}}),a("el-table-column",{attrs:{label:"批准状态","min-width":"100",prop:"ratifyStatus"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.ratifyStatus?a("el-tag",{attrs:{type:"success"}},[e._v("批准")]):e._e(),0===t.row.ratifyStatus?a("el-tag",{attrs:{type:"danger"}},[e._v("不批准")]):e._e()]}}])}),a("el-table-column",{attrs:{label:"批准内容","min-width":"150",prop:"ratifyRemark"}}),a("el-table-column",{attrs:{label:"批准人","min-width":"100",prop:"ratifyName"}}),a("el-table-column",{attrs:{label:"批准时间","min-width":"150",prop:"ratifyTime"}}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","min-width":"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:1===t.row.ratifyStatus,size:"small",type:"text"},on:{click:function(a){return e.addYearPlan("edit",t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{disabled:1===t.row.ratifyStatus,size:"small",type:"text"},on:{click:function(a){return e.tellApprove(t.row.planId)}}},[e._v("批准通知")]),a("el-button",{attrs:{disabled:1===t.row.ratifyStatus||e.userId!=t.row.ratifyUserId,size:"small",type:"text"},on:{click:function(a){return e.handleApprove(t.row.planId)}}},[e._v("批准")]),a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.downLoadPost(t.row.planId)}}},[e._v("导出")]),a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{disabled:1===t.row.ratifyStatus,size:"small",type:"text"},on:{click:function(a){return e.deleteFun(t.row.planId)}}},[e._v("删除")])]}}])})],1),a("el-pagination",{attrs:{"current-page":1,"page-size":e.pagination.size,"page-sizes":[10,20,30,50,100],background:"",total:e.pagination.total,layout:"->,total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),a("div",[e._m(1),a("div",{staticClass:"search"},[a("div",[a("el-form",{ref:"searchForm",attrs:{model:e.searchForm,size:"small",inline:!0}},[a("el-form-item",{attrs:{label:"设备名称及型号",prop:"deviceName"}},[a("el-input",{attrs:{clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getYearTableDetailData(e.currentRow)}},model:{value:e.searchForm.deviceName,callback:function(t){e.$set(e.searchForm,"deviceName",t)},expression:"searchForm.deviceName"}})],1),a("el-form-item",{attrs:{label:"仪器编号",prop:"deviceNumber"}},[a("el-input",{attrs:{clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getYearTableDetailData(e.currentRow)}},model:{value:e.searchForm.deviceNumber,callback:function(t){e.$set(e.searchForm,"deviceNumber",t)},expression:"searchForm.deviceNumber"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.getYearTableDetailData(e.currentRow)}}},[e._v("查询")]),a("el-button",{attrs:{size:"mini"},on:{click:e.reset}},[e._v("重置")])],1)],1)],1),a("div",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleForm("add")}}},[e._v("新增")])],1)]),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.yearTableDetailDataLoading,expression:"yearTableDetailDataLoading"}],ref:"yearTableDetailData",staticStyle:{width:"100%"},attrs:{data:e.yearTableDetailData,"header-cell-style":{background:"#f8f8f9",color:"#515a6e"},border:"",height:"calc(100vh - 34em)"}},[a("el-table-column",{attrs:{align:"center","header-align":"center",label:"序号",prop:"prop",type:"index",width:"70"}}),a("el-table-column",{attrs:{label:"设备名称及型号","min-width":"180",prop:"deviceName","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"设备数量","min-width":"180",prop:"deviceAmount"}}),a("el-table-column",{attrs:{label:"仪器编号","min-width":"150",prop:"deviceNumber"}}),a("el-table-column",{attrs:{label:"检定单位","min-width":"150",prop:"verificationUnit"}}),a("el-table-column",{attrs:{label:"检定周期","min-width":"150",prop:"verificationCycles"}}),a("el-table-column",{attrs:{label:"最近检定时间","min-width":"150",prop:"lastDate"}}),a("el-table-column",{attrs:{label:"本年计划校准时间","min-width":"150",prop:"planDate"}}),a("el-table-column",{attrs:{label:"备注","min-width":"150",prop:"remark"}}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleForm("edit",t.row)}}},[e._v("编辑")]),a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleForm("view",t.row)}}},[e._v("查看")]),a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{size:"small",type:"text"},on:{click:function(a){return e.deleteFun1(t.row.planDetailId)}}},[e._v("删除")])]}}])})],1),a("el-pagination",{attrs:{"current-page":1,"page-size":e.pagination1.size,"page-sizes":[10,20,30,50,100],background:"",total:e.pagination1.total,layout:"->,total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange1,"current-change":e.handleCurrentChange1}})],1)]),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.dialogVisible,title:"设备校准计划",width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.resetForm}},[a("el-form",{ref:"modelForm",attrs:{model:e.form,rules:e.rules,"label-width":"150px"}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备名称及型号：",prop:"deviceName"}},[a("el-input",{attrs:{disabled:"view"===e.operationType,clearable:"",size:"small"},model:{value:e.form.deviceName,callback:function(t){e.$set(e.form,"deviceName",t)},expression:"form.deviceName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"设备数量：",prop:"deviceAmount"}},[a("el-input",{attrs:{disabled:"view"===e.operationType,clearable:"",size:"small"},model:{value:e.form.deviceAmount,callback:function(t){e.$set(e.form,"deviceAmount",t)},expression:"form.deviceAmount"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"仪器编号：",prop:"deviceNumber"}},[a("el-input",{attrs:{disabled:"view"===e.operationType,clearable:"",size:"small"},model:{value:e.form.deviceNumber,callback:function(t){e.$set(e.form,"deviceNumber",t)},expression:"form.deviceNumber"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"检定单位：",prop:"verificationUnit"}},[a("el-input",{attrs:{disabled:"view"===e.operationType,clearable:"",size:"small"},model:{value:e.form.verificationUnit,callback:function(t){e.$set(e.form,"verificationUnit",t)},expression:"form.verificationUnit"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"检定周期：",prop:"verificationCycles"}},[a("el-input",{attrs:{disabled:"view"===e.operationType,clearable:"",size:"small"},model:{value:e.form.verificationCycles,callback:function(t){e.$set(e.form,"verificationCycles",t)},expression:"form.verificationCycles"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"最近检定时间：",prop:"lastDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:"view"===e.operationType,clearable:"",format:"yyyy-MM-dd",placeholder:"选择日期",size:"small",type:"date","value-format":"yyyy-MM-dd"},model:{value:e.form.lastDate,callback:function(t){e.$set(e.form,"lastDate",t)},expression:"form.lastDate"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"本年计划校准时间：",prop:"planDate"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{disabled:"view"===e.operationType,clearable:"",format:"yyyy-MM-dd",placeholder:"选择日期",size:"small",type:"date","value-format":"yyyy-MM-dd"},model:{value:e.form.planDate,callback:function(t){e.$set(e.form,"planDate",t)},expression:"form.planDate"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{disabled:"view"===e.operationType,clearable:"",size:"small"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.resetForm}},[e._v("取 消")]),"view"!==e.operationType?a("el-button",{attrs:{loading:e.submitFormLoading,type:"primary"},on:{click:e.submitForm}},[e._v("确 认")]):e._e()],1)],1),a("el-dialog",{attrs:{visible:e.approvalDialog,title:"批准",width:"30%"},on:{"update:visible":function(t){e.approvalDialog=t},close:function(t){e.approvalDialog=!1}}},[a("span",[e._v(" 批准备注： "),a("el-input",{attrs:{type:"textarea"},model:{value:e.ratifyRemark,callback:function(t){e.ratifyRemark=t},expression:"ratifyRemark"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:e.approvalLoading},on:{click:function(t){return e.handleApproval(0)}}},[e._v("不批准")]),a("el-button",{attrs:{loading:e.approvalLoading,type:"primary"},on:{click:function(t){return e.handleApproval(1)}}},[e._v("批 准")])],1)]),a("el-dialog",{attrs:{visible:e.notificationDia,title:"提交批准",width:"30%"},on:{"update:visible":function(t){e.notificationDia=t},close:e.closeNotificationDia}},[a("span",{staticStyle:{"margin-top":"10px",display:"inline-block"}},[e._v(" 请选择批准人： "),a("el-select",{staticStyle:{width:"90%"},attrs:{clearable:"",filterable:"",size:"small"},model:{value:e.ratifyUserId,callback:function(t){e.ratifyUserId=t},expression:"ratifyUserId"}},e._l(e.responsibleOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{loading:e.notificationLoading},on:{click:e.closeNotificationDia}},[e._v("取 消")]),a("el-button",{attrs:{loading:e.notificationLoading,type:"primary"},on:{click:e.notification}},[e._v("提 交")])],1)]),a("el-dialog",{attrs:{visible:e.uploadDia,title:"数据导入",width:"500px"},on:{"update:visible":function(t){e.uploadDia=t}}},[e._v(" 年份： "),a("el-date-picker",{attrs:{type:"year","value-format":"yyyy",clearable:"",format:"yyyy",placeholder:"选择年"},model:{value:e.planYear,callback:function(t){e.planYear=t},expression:"planYear"}}),a("div",{staticStyle:{margin:"0 auto"}},[a("el-upload",{ref:"upload1",attrs:{action:e.action,"auto-upload":!1,"file-list":e.fileList,headers:e.uploadHeader,limit:1,accept:".doc,.docx","on-change":e.beforeUpload,"on-error":e.onError,"on-success":e.handleSuccessUp,drag:"",name:"file"}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),a("em",[e._v("点击上传")])])])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.uploadDia=!1}}},[e._v("取 消")]),a("el-button",{attrs:{loading:e.uploading,type:"primary"},on:{click:function(t){return e.submitUpload()}}},[e._v("上 传")])],1)],1),e.addYearPlanDia?a("add-year-plan-dia",{ref:"addYearPlanDia",on:{closeDia:e.closeDia}}):e._e()],1)},l=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("年度计划表")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"title"},[a("span",{staticStyle:{"font-weight":"bold"}},[e._v("年度计划明细表")])])}],n=a("5530"),o=(a("14d9"),a("b0c0"),a("d3b7"),a("0643"),a("4e3e"),a("159b"),a("c3d1")),r=a("d0d7"),s=a("abac"),c=a("b9fe"),d=a("2f62"),u={name:"equipment-calibration-plan",components:{AddVerificationYearPlanDia:r["default"],AddYearPlanDia:o["default"]},props:{clickNodeVal:{type:Object,default:function(){return{}}}},data:function(){return{dialogVisible:!1,searchForm:{deviceName:"",deviceNumber:""},yearTableData:[],yearTableDetailData:[],pagination:{size:10,current:1,total:0},pagination1:{size:10,current:1,total:0},form:{deviceName:"",deviceAmount:"",deviceNumber:"",verificationUnit:"",verificationCycles:"",lastDate:"",planDate:"",remark:"",planId:"",planDetailId:""},operationType:"",rules:{deviceNumber:[{required:!0,message:"请填写仪器编号",trigger:"blur"}],planDate:[{required:!0,message:"请选择日期",trigger:"change"}]},yearTableDataLoading:!1,yearTableDetailDataLoading:!1,currentRow:{},approvalDialog:!1,approvalLoading:!1,submitFormLoading:!1,ratifyRemark:"",currentRowId:"",uploadDia:!1,uploading:!1,addYearPlanDia:!1,fileList:[],planYear:"",responsibleOptions:[],notificationDia:!1,notificationLoading:!1,ratifyUserId:"",planId:""}},mounted:function(){this.getYearTableData()},methods:{getYearTableData:function(){var e=this;this.yearTableDataLoading=!0,Object(s["Ub"])({current:1,size:99}).then((function(t){200==t.code&&(e.yearTableData=t.data.records,e.pagination.total=t.data.total,e.yearTableData.length>0&&(e.currentRow=e.yearTableData[0],e.$refs.yearTable.setCurrentRow(e.currentRow))),e.yearTableDataLoading=!1})).catch((function(t){e.yearTableDataLoading=!1}))},handleSizeChange:function(e){this.pagination.size=e,this.getYearTableData()},handleCurrentChange:function(e){this.pagination.current=e,this.getYearTableData()},tellApprove:function(e){this.getUserList(),this.notificationDia=!0,this.planId=e},closeNotificationDia:function(){this.notificationDia=!1,this.ratifyUserId=""},notification:function(){var e=this;this.ratifyUserId?(this.notificationLoading=!0,Object(s["uc"])({ratifyUserId:this.ratifyUserId,planId:this.planId}).then((function(t){e.notificationLoading=!1,200==t.code&&(e.closeNotificationDia(),e.getYearTableData())})).catch((function(t){e.notificationLoading=!1}))):this.$message.warning("请选择批准人")},handleApprove:function(e){this.currentRowId=e,this.approvalDialog=!0},downLoadPost:function(e){var t=this;Object(s["bb"])({planId:e}).then((function(e){var a=new Blob([e],{type:"application/msword"});t.$download.saveAs(a,"设备校准计划.docx")}))},deleteFun:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["x"])({planId:e}).then((function(e){t.$message.success("删除成功！"),t.getYearTableData()}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},deleteFun1:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["y"])({planDetailsId:e}).then((function(e){t.$message.success("删除成功！"),t.getYearTableDetailData(t.currentRow)}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},currentChange:function(e){this.currentRow=e,this.getYearTableDetailData(this.currentRow)},getYearTableDetailData:function(e){var t=this;this.yearTableDetailDataLoading=!0,Object(s["Vb"])({current:this.pagination1.current,size:this.pagination1.size,planId:e.planId,deviceName:this.searchForm.deviceName,deviceNumber:this.searchForm.deviceNumber}).then((function(e){200==e.code&&(t.yearTableDetailData=e.data.records,t.pagination1.total=e.data.total),t.yearTableDetailDataLoading=!1})).catch((function(e){t.yearTableDetailDataLoading=!1}))},reset:function(){this.searchForm={deviceName:"",deviceNumber:""},this.getYearTableDetailData(this.currentRow)},handleSizeChange1:function(e){this.pagination1.size=e,this.getYearTableDetailData(this.currentRow)},handleCurrentChange1:function(e){this.pagination1.current=e,this.getYearTableDetailData(this.currentRow)},handleForm:function(e,t){var a=this;this.operationType=e,this.dialogVisible=!0,this.form.planId=this.currentRow.planId,"add"!==this.operationType?this.$nextTick((function(){a.form=a.HaveJson(t)})):this.form={deviceName:"",deviceAmount:"",deviceNumber:"",verificationUnit:"",verificationCycles:"",lastDate:"",planDate:"",remark:"",planId:this.currentRow.planId,planDetailId:""}},submitForm:function(){var e=this;this.$refs.modelForm.validate((function(t){t&&("add"===e.operationType?(e.submitFormLoading=!0,Object(s["e"])(e.form).then((function(t){200==t.code&&(e.$message.success("新增成功"),e.dialogVisible=!1,e.getYearTableData()),e.submitFormLoading=!1})).catch((function(t){e.submitFormLoading=!1}))):(e.submitFormLoading=!0,Object(s["Cc"])(e.form).then((function(t){200==t.code&&(e.$message.success("新增成功"),e.dialogVisible=!1,e.getYearTableData()),e.submitFormLoading=!1})).catch((function(t){e.submitFormLoading=!1}))))}))},addYearPlan:function(e,t){var a=this;this.addYearPlanDia=!0,this.$nextTick((function(){a.$refs.addYearPlanDia.openDialog(e,t)}))},closeDia:function(){this.addYearPlanDia=!1,this.getYearTableData()},submitUpload:function(){this.planYear?0!==this.$refs.upload1.uploadFiles.length?(this.uploading=!0,this.$refs.upload1.submit()):this.$message.error("未选择文件"):this.$message.warning("请选择年份")},handleApproval:function(e){var t=this,a={planId:this.currentRowId,ratifyRemark:this.ratifyRemark,ratifyStatus:e};this.approvalLoading=!0,Object(s["cc"])(a).then((function(e){200===e.code&&(t.$message.success("提交成功！"),t.approvalDialog=!1,t.getYearTableData()),t.approvalLoading=!1})).catch((function(){t.approvalLoading=!1}))},resetForm:function(){this.$refs.modelForm.resetFields(),this.dialogVisible=!1},record:function(e){this.uploadDia=!0},beforeUpload:function(e){return!(e.size>10485760)||(this.$message.error("上传文件不超过10M"),this.$refs.upload.clearFiles(),!1)},onError:function(e,t,a){this.$message.error("上传失败"),this.$refs.upload.clearFiles()},handleSuccessUp:function(e){this.uploading=!1,200==e.code?(this.$message.success("上传成功"),this.getYearTableData()):this.$message.error("上传失败")},getUserList:function(){var e=this;Object(c["g"])().then((function(t){if(200==t.code){var a=[];t.data.forEach((function(e){a.push({label:e.name,value:e.id})})),e.responsibleOptions=a}}))}},computed:Object(n["a"])({action:function(){return this.javaApi+"/deviceCalibrationPlan/importDeviceCalibrationPlan?planYear="+this.planYear}},Object(d["b"])(["userId"]))},p=u,m=(a("e0ab"),a("2877")),f=Object(m["a"])(p,i,l,!1,null,"75acecd5",null);t["default"]=f.exports},c3d1:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.applicationForm,title:"添加设备校准计划",width:"80%"},on:{"update:visible":function(t){e.applicationForm=t},close:e.closeDialog}},[a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("el-button",{staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"primary"},on:{click:e.addTableRow}},[e._v("添加")]),a("span",{staticStyle:{width:"80px"}},[e._v("计划名称：")]),a("el-input",{staticStyle:{width:"300px","margin-right":"10px"},attrs:{clearable:"",size:"small"},model:{value:e.form.planName,callback:function(t){e.$set(e.form,"planName",t)},expression:"form.planName"}}),a("span",{staticStyle:{width:"60px"}},[e._v("年份：")]),a("el-date-picker",{attrs:{clearable:"",format:"yyyy",placeholder:"选择年",size:"small",type:"year","value-format":"yyyy"},model:{value:e.form.planYear,callback:function(t){e.$set(e.form,"planYear",t)},expression:"form.planYear"}})],1),a("div",{staticStyle:{margin:"10px 0"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.yearTableLoading,expression:"yearTableLoading"}],ref:"yearTable",staticStyle:{width:"100%"},attrs:{id:"templateParamTable",data:e.calibrationPlanDetailList,height:"300px","header-cell-style":{background:"#f8f8f9",color:"#515a6e"},border:"","row-key":"deviceId"}},[a("el-table-column",{attrs:{label:"设备名称及型号","min-width":"190",prop:"deviceName"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:"",size:"small"},model:{value:t.row.deviceName,callback:function(a){e.$set(t.row,"deviceName",a)},expression:"scope.row.deviceName"}})]}}])}),a("el-table-column",{attrs:{label:"仪器编号","min-width":"190",prop:"deviceNumber"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:"",size:"small"},model:{value:t.row.deviceNumber,callback:function(a){e.$set(t.row,"deviceNumber",a)},expression:"scope.row.deviceNumber"}})]}}])}),a("el-table-column",{attrs:{label:"设备数量","min-width":"120",prop:"deviceAmount"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:"",size:"small"},model:{value:t.row.deviceAmount,callback:function(a){e.$set(t.row,"deviceAmount",a)},expression:"scope.row.deviceAmount"}})]}}])}),a("el-table-column",{attrs:{label:"检定单位","min-width":"120",prop:"verificationUnit"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:"",size:"small"},model:{value:t.row.verificationUnit,callback:function(a){e.$set(t.row,"verificationUnit",a)},expression:"scope.row.verificationUnit"}})]}}])}),a("el-table-column",{attrs:{label:"核准周期(月)","min-width":"120",prop:"verificationCycles"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:"",size:"small"},model:{value:t.row.verificationCycles,callback:function(a){e.$set(t.row,"verificationCycles",a)},expression:"scope.row.verificationCycles"}})]}}])}),a("el-table-column",{attrs:{label:"最近校准时间","min-width":"170",prop:"lastDate"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:"",format:"yyyy-MM-dd",placeholder:"选择日期",size:"small",type:"date","value-format":"yyyy-MM-dd"},model:{value:t.row.lastDate,callback:function(a){e.$set(t.row,"lastDate",a)},expression:"scope.row.lastDate"}})]}}])}),a("el-table-column",{attrs:{label:"本年计划校准时间","min-width":"170",prop:"planDate"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:"",format:"yyyy-MM-dd",placeholder:"选择日期",size:"small",type:"date","value-format":"yyyy-MM-dd"},model:{value:t.row.planDate,callback:function(a){e.$set(t.row,"planDate",a)},expression:"scope.row.planDate"}})]}}])}),a("el-table-column",{attrs:{label:"备注","min-width":"170",prop:"remark"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{clearable:"",size:"small"},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),a("el-table-column",{attrs:{align:"center",fixed:"right",label:"操作",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(a){return e.deleteRow(t.$index)}}},[e._v("删除")])]}}])})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeDialog}},[e._v("取 消")]),a("el-button",{attrs:{loading:e.submitFormLoading,type:"primary"},on:{click:e.submitForm}},[e._v("确 认")])],1)]),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.addEquipDia,title:"新增年度计划",width:"50%"},on:{"update:visible":function(t){e.addEquipDia=t}}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.equipOptions,height:"500","tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"设备名称",prop:"label"}}),a("el-table-column",{attrs:{label:"设备编号",prop:"value"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addEquipDia=!1}}},[e._v("取 消")]),a("el-button",{attrs:{loading:e.submitFormLoading,type:"primary"},on:{click:e.changeMachineName}},[e._v("确 认")])],1)],1)],1)},l=[],n=(a("99af"),a("d81d"),a("14d9"),a("a434"),a("d3b7"),a("4d90"),a("0643"),a("a573"),a("abac")),o=a("aa47"),r={name:"addYearPlanDia",components:{},data:function(){return{applicationForm:!1,addEquipDia:!1,submitFormLoading:!1,equipOptions:[],calibrationPlanDetailList:[],selectionRows:[],form:{planName:"",planYear:"",planId:"",calibrationPlanDetailList:[]},operationType:"",yearTableLoading:!1}},mounted:function(){},methods:{openDialog:function(e,t){this.operationType=e,"add"===e?(this.form={planName:"",planYear:"",calibrationPlanDetailList:[]},this.calibrationPlanDetailList=[]):this.getRowInfo(t),this.applicationForm=!0},getRowInfo:function(e){var t=this;this.yearTableLoading=!0,Object(n["wb"])({planId:e.planId}).then((function(e){t.yearTableLoading=!1,200==e.code&&(t.calibrationPlanDetailList=e.data.calibrationPlanDetailList,t.form.planName=e.data.planName,t.form.planYear=e.data.planYear,t.form.planId=e.data.planId)})).catch((function(e){t.yearTableLoading=!1}))},addTableRow:function(){this.addEquipDia=!0,this.getEquipOptions()},handleSelectionChange:function(e){this.selectionRows=e},changeMachineName:function(){var e=this;this.selectionRows.map((function(t){var a=t.nextCalibrationDate?new Date(t.nextCalibrationDate):null;a&&a.setDate(a.getDate()-5),e.calibrationPlanDetailList.push({deviceId:t.id,deviceName:t.label,deviceNumber:t.value,specificationModel:t.specificationModel,verificationCycles:t.calibrationDate,lastDate:t.lastCalibrationDate&&t.lastCalibrationDate.substring(0,10),planDate:a?s(a):null,verificationUnit:t.calibrationServices,deviceAmount:1})})),this.addEquipDia=!1,this.rowDrop()},rowDrop:function(){var e=this,t=document.querySelector("#templateParamTable .el-table__body-wrapper tbody");this.sortTable||(this.sortTable=o["default"].create(t,{animation:200,handle:".el-table__row",onMove:function(t){var a=t.dragged,i=t.related;e.calibrationPlanDetailList[a.rowIndex],e.calibrationPlanDetailList[i.rowIndex]},onEnd:function(t){var a=e.calibrationPlanDetailList.splice(t.oldIndex,1)[0];e.calibrationPlanDetailList.splice(t.newIndex,0,a)}}))},deleteRow:function(e){this.calibrationPlanDetailList.splice(e,1)},submitForm:function(){var e=this;this.form.calibrationPlanDetailList=this.HaveJson(this.calibrationPlanDetailList),this.submitFormLoading=!0,"add"===this.operationType?Object(n["d"])(this.form).then((function(t){200==t.code&&(e.$message.success("新增成功"),e.closeDialog(),e.$emit("closeDia")),e.submitFormLoading=!1})).catch((function(t){e.submitFormLoading=!1})):Object(n["Bc"])(this.form).then((function(t){200==t.code&&(e.$message.success("新增成功"),e.closeDialog(),e.$emit("closeDia")),e.submitFormLoading=!1})).catch((function(t){e.submitFormLoading=!1}))},closeDialog:function(){this.applicationForm=!1},getEquipOptions:function(){var e=this;this.equipOptions=[],Object(n["W"])({status:0}).then((function(t){200===t.code&&t.data&&(e.equipOptions=t.data.map((function(e){return e.value=e.managementNumber,e.label=e.deviceName,e})))})).catch((function(e){console.error(e)}))}}};function s(e){var t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(i)}var c=r,d=a("2877"),u=Object(d["a"])(c,i,l,!1,null,"13367feb",null);t["default"]=u.exports},e0ab:function(e,t,a){"use strict";a("71ca")}}]);