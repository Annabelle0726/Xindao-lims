(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0b1e391f"],{"0ccb":function(e,t,a){"use strict";var i=a("e330"),s=a("50c4"),r=a("577e"),n=a("1148"),l=a("1d80"),o=i(n),c=i("".slice),d=Math.ceil,u=function(e){return function(t,a,i){var n,u,m=r(l(t)),h=s(a),p=m.length,v=void 0===i?" ":r(i);return h<=p||""===v?m:(n=h-p,u=o(v,d(n/v.length)),u.length>n&&(u=c(u,0,n)),e?m+u:u+m)}};e.exports={start:u(!1),end:u(!0)}},"4d90":function(e,t,a){"use strict";var i=a("23e7"),s=a("0ccb").start,r=a("9a0c");i({target:"String",proto:!0,forced:r},{padStart:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}})},"9a0c":function(e,t,a){"use strict";var i=a("342f");e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)},a5b4:function(e,t,a){},bc67:function(e,t,a){"use strict";a("a5b4")},ea92:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("div",{staticStyle:{"margin-top":"10px"}},[a("el-row",{staticClass:"title"},[a("el-col",{staticStyle:{"text-align":"left"},attrs:{span:12}},[e._v("预定总览")]),a("el-col",{staticStyle:{"text-align":"left","padding-bottom":"10px"},attrs:{span:12}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd",placeholder:"选择起始日期",size:"mini",type:"date","value-format":"yyyy-MM-dd"},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}}),e._v(" 至 "),a("el-date-picker",{attrs:{format:"yyyy-MM-dd",placeholder:"选择结束日期",size:"mini",type:"date","value-format":"yyyy-MM-dd"},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}}),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.ValidateAndQuery}},[e._v("查询")])],1)],1)],1),a("div",{staticClass:"table-container"},[a("el-table",{staticClass:"scrollable-table",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f8f8f9",color:"#515a6e"},border:""}},[a("el-table-column",{attrs:{label:"序号",type:"index",width:"60"}}),a("el-table-column",{attrs:{label:"设备","min-width":"60",prop:"deviceName"}}),a("el-table-column",{attrs:{label:"时间","min-width":"60",prop:"time"}}),e._l(e.dates,(function(t){return a("el-table-column",{key:t,attrs:{label:t},scopedSlots:e._u([{key:"default",fn:function(i){var s=i.row;return[s[t]?a("span"):a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.openModal(t,s)}}},[e._v(" "+e._s(e.getDisplayText(s,t))+" ")])]}}],null,!0)})}))],2),a("el-dialog",{attrs:{"close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.showModal,title:"预定信息",top:"5vh",width:"70%"},on:{"update:visible":function(t){e.showModal=t}}},[a("h4",[e.isBeforeDate()?a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.cancelReservation(e.selectedRow)}}},[e._v("取消预定")]):e._e(),e.isBeforeDate()?a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.openAdd()}}},[e._v("新建预定")]):e._e()],1),a("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData2,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55%"}}),a("el-table-column",{attrs:{label:"序号",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){t.row;var a=t.$index;return[e._v(" "+e._s(a+1)+" ")]}}])}),a("el-table-column",{attrs:{label:"预定编号",prop:"deviceNumber",width:"120"}}),a("el-table-column",{attrs:{label:"客户名称",prop:"customerName","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"联系人",prop:"linkPerson","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"联系电话",prop:"phone","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"预定说明",prop:"reservationSpecification","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"创建人",prop:"name","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"创建时间",prop:"createDate","show-overflow-tooltip":""}})],1)],1)],1),a("el-dialog",{attrs:{visible:e.addVisiable,title:"新建预定",top:"5vh",width:"40%"},on:{"update:visible":function(t){e.addVisiable=t}}},[a("el-form",{ref:"addReservationForm",attrs:{model:e.addReservation,rules:e.rules,"label-width":"90px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"预定设备:"}},[a("el-input",{model:{value:e.addReservation.deviceName,callback:function(t){e.$set(e.addReservation,"deviceName",t)},expression:"addReservation.deviceName"}})],1),a("el-form-item",{attrs:{label:"客户名称:"}},[a("el-input",{model:{value:e.addReservation.customerName,callback:function(t){e.$set(e.addReservation,"customerName",t)},expression:"addReservation.customerName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"预定时间:"}},[a("el-input",{model:{value:e.addReservation.reservationTime,callback:function(t){e.$set(e.addReservation,"reservationTime",t)},expression:"addReservation.reservationTime"}})],1),a("el-form-item",{attrs:{label:"流程编号:"}},[a("el-input",{model:{value:e.addReservation.deviceNumber,callback:function(t){e.$set(e.addReservation,"deviceNumber",t)},expression:"addReservation.deviceNumber"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"联系人:"}},[a("el-input",{model:{value:e.addReservation.linkPerson,callback:function(t){e.$set(e.addReservation,"linkPerson",t)},expression:"addReservation.linkPerson"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"联系电话:",prop:"phone"}},[a("el-input",{model:{value:e.addReservation.phone,callback:function(t){e.$set(e.addReservation,"phone",t)},expression:"addReservation.phone"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"预定说明:",required:""}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.addReservation.reservationSpecification,callback:function(t){e.$set(e.addReservation,"reservationSpecification",t)},expression:"addReservation.reservationSpecification"}})],1)],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addVisiable=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.addRecord}},[e._v("确 定")])],1)],1)],1)},s=[],r=a("c14f"),n=a("1da1"),l=a("b85c"),o=(a("99af"),a("a15b"),a("d81d"),a("14d9"),a("fb6a"),a("d3b7"),a("4d90"),a("0643"),a("a573"),{props:{clickNodeVal:{type:Object,default:function(){return{}}}},data:function(){return{timeSlots:["09:00-12:00","13:00-18:00","18:00-22:00"],dates:[],showModal:!1,selectedDate:"",selectedTime:"",selectedDevice:"",tableData:[{id:"",deviceName:"",date:""}],tableData2:[],selectedReservationId:null,selectedRow:null,addVisiable:!1,laboratoryNameIsNull:!1,currentPage:1,pageSize:16,startTime:"",endTime:"",entity:{deviceName:null,laboratoryName:"",storagePoint:""},addReservation:{deviceName:"",reservationTime:"",specificTime:"",customerName:"",deviceNumber:"",linkPerson:"",phone:"",reservationSpecification:""},total:"",componentData:{entity:{largeCategory:null,orderBy:{field:"id",order:"asc"}}},yuyue:null,yuyuetime:"",rules:{phone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号码",trigger:["blur","change"]}]},appointment:""}},watch:{clickNodeVal:function(e){this.clickSidebar(e)}},created:function(){this.clickSidebar(this.clickNodeVal),this.initDate()},mounted:function(){this.getAllDeviceParam()},methods:{isBeforeDate:function(){var e=this.$moment().format("YYYY-MM-DD"),t=this.$moment().format("HH"),a=this.appointment&&this.appointment.split("-"),i="";if(""!==a&&(a[0].slice(0,2),i=a[1].slice(0,2)),e<this.yuyuetime)return!0;if(e===this.yuyuetime){if(t<i)return!0;if(t>i)return!1}},getDisplayText:function(e,t){if(!e||null===e.dateList||void 0===e.dateList||""===e.dateList)return"预约";var a,i=e.dateList,s=Object(l["a"])(i);try{for(s.s();!(a=s.n()).done;){var r=a.value;if(r.date===t)return 0===r.value?"预约":r.value}}catch(n){s.e(n)}finally{s.f()}return"预约"},ValidateAndQuery:function(){this.startTime&&this.endTime?(new Date(this.endTime)-new Date(this.startTime))/864e5>=10?this.$message.error("只能预约10天以内"):new Date(this.startTime)>new Date(this.endTime)?this.$message.error("开始日期不能大于结束日期"):this.query():this.$message.error("请选择日期范围")},initDate:function(){if(""==this.startTime||""==this.endTime||null==this.startTime||null==this.endTime){var e=3,t=new Date;this.startTime=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0");var a=new Date(t);a.setDate(t.getDate()+e),this.endTime=a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0")+"-"+String(a.getDate()).padStart(2,"0");var i=new Date(this.startTime),s=new Date(this.endTime),r=[];while(i<=s){var n=i.getFullYear(),l=String(i.getMonth()+1).padStart(2,"0"),o=String(i.getDate()).padStart(2,"0");r.push("".concat(n,"-").concat(l,"-").concat(o)),i.setDate(i.getDate()+1)}this.dates=r,this.getStartTimeAndEndTime()}},query:function(){if(this.startTime&&this.endTime){var e=new Date(this.startTime),t=new Date(this.endTime),a=[];while(e<=t){var i=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");a.push("".concat(i,"-").concat(s,"-").concat(r)),e.setDate(e.getDate()+1)}this.dates=a,this.getStartTimeAndEndTime()}},getStartTimeAndEndTime:function(){var e=this;this.$axios.post(this.$api.deviceReservate.get+"?laboratoryNameIsNull="+this.laboratoryNameIsNull+"&starttime="+this.startTime+"&endtime="+this.endTime,{page:{current:this.currentPage,size:this.pageSize},entity:this.entity},{headers:{"Content-Type":"application/json"}}).then((function(t){if(200==t.code){var a=t.data.body;e.initTable(a)}}))},updateDates:function(){if(this.startTime&&this.endTime){var e=new Date(this.startDate),t=new Date(this.endDate),a=[];while(e<=t){var i=e.getMonth()+1,s=e.getDate();a.push("".concat(i,"/").concat(s)),e.setDate(e.getDate()+1)}this.dates=a,this.initTableData(devices)}},getAllDeviceParam:function(){var e=this;this.$axios.post(this.$api.deviceReservate.get+"?laboratoryNameIsNull="+this.laboratoryNameIsNull,{page:{current:this.currentPage,size:this.pageSize},entity:this.entity},{headers:{"Content-Type":"application/json"}}).then((function(t){if(200==t.code){var a=t.data.body;e.initTable(a)}}))},initTable:function(e){this.tableData=e},openModal:function(e,t){this.yuyue=t,this.yuyuetime=e,this.appointment=t.time,this.showModal=!0,this.getList()},openAdd:function(){this.addVisiable=!0,this.addReservation.deviceId=this.yuyue.id,this.addReservation.deviceName=this.yuyue.deviceName,this.addReservation.reservationTime=this.yuyuetime+" "+this.yuyue.time,this.addReservation.specificTime=this.yuyue.time,this.addReservation.deviceNumber="TX-ABC-01"+Math.floor(10*Math.random()+1)},handleSelectionChange:function(e){this.selectedRow=e.length>0?e:null},cancelReservation:function(e){var t=this;return Object(n["a"])(Object(r["a"])().m((function a(){var i,s;return Object(r["a"])().w((function(a){while(1)switch(a.n){case 0:if(e&&0!=e.length){a.n=1;break}return t.$message.error("请选择要删除的预约"),a.a(2);case 1:return i=e.map((function(e){return e.id})).join(","),a.p=2,a.n=3,t.$axios.delete(t.$api.deviceReservate.del+"/"+i);case 3:s=a.v,200===s.code?(t.$message.success({message:"删除成功",type:"success"}),t.getList(),t.query(),t.showModal=!1):t.$message.error({message:"删除失败",type:"error"}),a.n=5;break;case 4:a.p=4,a.v,t.$message.error({message:"删除过程中发生错误，请稍后重试",type:"error"});case 5:return a.a(2)}}),a,null,[[2,4]])})))()},addRecord:function(){var e=this;this.$refs.addReservationForm.validate((function(t){if(!t)return e.$message.error({message:"请检查表单填写是否正确",type:"error"}),!1;e.addReservation.reservationTime=e.yuyuetime,e.$axios.post(e.$api.deviceReservate.save,e.addReservation).then((function(t){200==t.code&&(e.$message.success("保存成功"),e.addVisiable=!1,e.getList(),e.query(),e.addReservation={})}))}))},getList:function(){var e=this;this.$axios.post(this.$api.deviceReservate.list+"?deviceId="+this.yuyue.id+"&reservationTime="+this.yuyuetime+"&specificTime="+this.yuyue.time).then((function(t){200==t.code&&(e.tableData2=t.data)}))},clickSidebar:function(e){if(this.laboratoryNameIsNull=!1,!e.value){if(this.finishLoding=!1,this.keyMap={},this.currentPage=1,this.list=[],this.entity.laboratoryName=null,this.entity.storagePoint=null,"其他"==e.label)return this.laboratoryNameIsNull=!0,void this.getAllDeviceParam();1==e.level?this.entity.laboratoryName=e.label:2==e.level&&("其他"==e.parent.label?this.laboratoryNameIsNull=!0:this.entity.laboratoryName=e.parent.label,this.entity.storagePoint=e.label),this.getAllDeviceParam()}}}}),c=o,d=(a("bc67"),a("2877")),u=Object(d["a"])(c,i,s,!1,null,"b9a7cfae",null);t["default"]=u.exports}}]);